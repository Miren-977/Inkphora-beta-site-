<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Inkphora / Thymiko — Private Beta</title>

  <!-- Icons & OG -->
  <link rel="icon" href="/favicon-v10.ico" sizes="any">
  <link rel="icon" type="image/png" href="/favicon-v10.png" sizes="512x512">
  <link rel="apple-touch-icon" href="/favicon-v10.png">
  <meta property="og:image" content="/assets/inkphora-logo-v10.png" />

  <!-- Your existing CSS -->
  <link rel="stylesheet" href="/style.css?v=3">
</head>
<body>
  <!-- Top bar -->
  <header class="wrap">
    <div class="brand">
      <img src="/assets/inkphora-logo-v10.png" alt="Inkphora" class="logo" style="height:64px;width:auto" />
    </div>
    <nav>
      <a href="#waitlist">Join Beta</a>
      <a href="/privacy.html">Privacy</a>
    </nav>
  </header>

  <!-- Hero -->
  <main class="wrap hero" style="text-align:center;padding:48px 0 24px">
    <h1 style="margin:0 0 8px">Inkphora / Thymiko</h1>
    <p class="sub" style="margin:0 0 12px">
      Empathic AI for emotional well-being — <strong>3 months free</strong> for early testers
    </p>
    <div style="margin:10px 0 18px;opacity:.95">
      <img src="/assets/thymiko-logo-v10.png" alt="Thymiko" style="height:86px;width:auto">
    </div>
    <a class="btn btn-primary" href="#waitlist">Join Beta</a>
  </main>

  <!-- Waitlist card -->
  <section class="wrap" id="waitlist">
    <div class="card" style="max-width:760px;margin:0 auto">
      <h3 style="margin-top:0">Join the Private Beta</h3>

      <form id="beta-form" autocomplete="on" novalidate>
        <!-- Honeypot (spam trap) -->
        <input type="text" name="hp" id="hp" style="display:none" tabindex="-1" autocomplete="off">

        <div style="display:flex;gap:10px;flex-wrap:wrap">
          <input type="email" id="email" name="email" placeholder="you@example.com" required>
          <button type="submit" class="btn btn-primary" id="btnSubmit">Join Beta</button>
        </div>

        <p class="consent" style="margin:.6rem 0 0">
          <label><input type="checkbox" id="consent" required>
            I consent to receive beta updates for Inkphora / Thymiko (unsubscribe anytime).
          </label>
        </p>
      </form>

      <p id="beta-msg" class="small" style="margin-top:.6rem;color:var(--muted)"></p>
    </div>
  </section>

  <footer class="wrap" style="text-align:center;margin:36px 0 24px">
    <small>© 2025 Inkphora • Prototype: Thymiko • <a href="/privacy.html">Privacy</a></small>
  </footer>

  <noscript>
    <div class="wrap" style="max-width:760px;margin:1rem auto;color:#c00">
      JavaScript is required to join the waitlist.
    </div>
  </noscript>

  <!-- Connector to Netlify Function -->
  <script>
  document.addEventListener('DOMContentLoaded', () => {
    const form = document.getElementById('beta-form');
    const msg  = document.getElementById('beta-msg');
    const btn  = document.getElementById('btnSubmit');

    function say(text, ok=false){
      msg.style.color = ok ? '#28c76f' : '#ff4d4f';
      msg.textContent = text;
    }

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      msg.textContent = '';
      btn.disabled = true;

      const email   = document.getElementById('email').value.trim();
      const consent = document.getElementById('consent').checked;
      const hp      = document.getElementById('hp').value.trim();

      // Honeypot: se pieno, è bot → esci in silenzio
      if (hp) { btn.disabled = false; return say('OK', true); }

      // Validazione minima
      const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!re.test(email) || !consent){
        btn.disabled = false;
        return say('Please enter a valid email and accept consent.');
      }

      try {
        const res = await fetch('/.netlify/functions/subscribe', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email, consent })
        });

        if (!res.ok){
          const t = await res.text().catch(()=> '');
          throw new Error(`HTTP ${res.status} ${t || ''}`.trim());
        }

        // Successo: messaggio + redirect alla thank-you
        say('Thanks! Check your inbox for our welcome email.', true);
        setTimeout(() => { window.location.href = '/thank-you.html'; }, 1200);

      } catch (err){
        console.error(err);
        say('Connection error. Please try again later.');
      } finally {
        btn.disabled = false;
      }
    });
  });
  </script>
</body>
</html>
